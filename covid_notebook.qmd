---
title: "Mobilité en Wallonie avant et pendant la pandémie du Covid-19"
author: "Hocquet Anaïs, Lebourgeois Solène & Vanderhaegen Lucie"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but. Vous devez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

... Introduction et but...

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets déjà réalisés. -->

Les données viennent de Datacovid qui vient de Google.

L'analyse est réalisée avec la [SciViews Box 2023](https://www.sciviews.org/software/svbox/) dans [Saturn Cloud](https://saturncloud.io) (Linux), utilisant le [logiciel R](https://www.r-project.org) (`r R.version.string`). Le package {pastecs} version `r packageVersion("pastecs")` est utilisé pour étudier la série temporelle.

## Analyses

<!--% Lisez bien les éléments devant guider votre analyse proposée dans le README.-->

```{r setup, include=FALSE}
# Nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configuration de l'environnement
SciViews::R("ts")
```

<!--% Ajoutez le nombre de chunks que vous souhaitez. Répartissez-vous le travail correctement. Structurez la section en partie avec des titres explicites de niveau trois.-->
```{r importation}
# Importation des données et descriptions de celles-ci avec représentation graphique
# Anaïs
covid <- read("data/mobility_wallonia.rds")
#Un remaniement des données est nécessaire pour renommer les variables de façon plus simple à utiliser
covid <- srename(covid, retail_and_recreation_percent_change_from_baseline = retail_recreation,
  grocery_and_pharmacy_percent_change_from_baseline = grocery_pharmacy,
  parks_percent_change_from_baseline = parks,
  transit_stations_percent_change_from_baseline = transit,
  workplaces_percent_change_from_baseline = workplaces,
  residential_percent_change_from_baseline = residential)
#visualisation des données telles quelles
skimr::skim(covid)
```
Notre jeu de données que nous nommons "covid" possède 974 observations pour 7 variables. Nous avons 1 observation par jour, du 15 février 2020 au 15 octobre 2022. Nous allons représenter ces données sous forme de série chronologique.

```{r ts}
# création de l'objet ts ou mts + vérification avec class() + visualisation des données
# Anaïs
covid_ts <- ts(covid, start = c(2020, 2, 15), frequency = 365)
plot(covid_ts)
# Copie de la série initiale sous une autre nom
mobw <- covid
# Calcul des jours de la semaine
mobw$weekdays <- weekdays(as.POSIXct(mobw$date))
# Les données du week-end sont remplacées par des valeurs manquantes
mobw[mobw$weekdays == "Saturday" | mobw$weekdays == "Sunday" , 2:7] <- NA 


```
Pour chaque variable, une série chronologique est créée. Au 0, c'est la valeur de départ, le déplacement "classique", normal, pas de déplacement supplémentaire ou moins de déplacement pour la raison de la variable. Quand la valeur est négative, le taux de déplacement est moindre comparé aux années d'avant "normales". Quand elle est positive, le déplacement est supérieur par rapport aux années d'avant.
Pour l'axe du temps, lorsque le temps s'affiche, par exemple, "2020.5", cela signifie que nous sommes à la moitié de l'année.
Au cas où, pour les futures analyses, les différentes séries ont également été scindées (au lieu d'avoir un seul objet mts avec toutes les séries comprises, il y aura différents objets de classe ts)
L'analyse est scindée, entre les weekends et les jours de la semaine.

```{r retail and recreation}
#Anaïs sur l'analyse des déplacements vers les magasins de détail et loisirs
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
mobw_ts <- ts(mobw$retail_recreation, start = c(2020, 46), frequency = 365)
plot(mobw_ts)
# Aggrégation par moyenne des valeurs par semaine
retail_recreation_ts <- aggregate(mobw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(retail_recreation_ts, ylab = "Pourcentage de déplacement vers les magasins de détail et loisirs", xlab = "Temps")

```
Pour la première série choisie, nous prenons la variable retail_recreation. Cela correspond au taux de déplacement depuis la norme (0). Si la valeur est négative, il y a moins de déplacement vers les magasins de détail et loisirs. Si la valeur est positives, la population a eu tendance à davantage se déplacer vers ceux-ci. 

```{r ts_residential}
# Lucie sur la VAR = residential
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020) selon la variable residential
residential_ts <- ts(mobw$residential, start = c(2020, 46), frequency = 365)
plot(residential_ts)
# Aggrégation par moyenne des valeurs par semaine
residential_ts1 <- aggregate(residential_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(residential_ts1, ylab = "Pourcentage de déplacement vers les lieux de résidences")
```

```{r ts_workplaces}
# Solène sur la VAR = workplaces
workplaces_ts <- ts(mobw$workplaces, start = c(2020, 46), frequency = 365)
plot(mobw_ts)
# Aggrégation par moyenne des valeurs par semaine
workplaces_ts2 <- aggregate(mobw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(workplaces_ts2, ylab = "Pourcentage de déplacement vers les lieux de travails")
```
## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les éléments les plus pertinents que vous retenez ? -->

...vos conclusions ici...
